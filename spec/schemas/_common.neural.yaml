openapi: 3.1.0
info:
  title: Schemas of `_common.neural` Category
  description: Schemas of `_common.neural` category.
  version: 1.0.0
components:
  schemas:
    NeuralStats:
      oneOf:
        - \$ref: '#/components/schemas/NestedNeuralStats'
        - \$ref: '#/components/schemas/FlatNeuralStats'
    # Separate schemas for flattened vs unflattened
    NestedNeuralStats:
      type: object
      properties:
        _nodes:
          \$ref: '#/components/schemas/NodesInfo'
        cluster_name:
          type: string
        info:
          type: object
          properties:
            cluster_version:
              \$ref: '#/components/schemas/StatValue'
            processors:
              type: object
              properties:
                ingest:
                  type: object
                  properties:
                    text_embedding_processors_in_pipelines:
                      \$ref: '#/components/schemas/StatValue'
        all_nodes:
          type: object
          properties:
            processors:
              type: object
              properties:
                ingest:
                  type: object
                  properties:
                    text_embedding_executions:
                      \$ref: '#/components/schemas/StatValue'
        nodes:
          type: object
          additionalProperties:
            type: object
            properties:
              processors:
                type: object
                properties:
                  ingest:
                    type: object
                    properties:
                      text_embedding_executions:
                        \$ref: '#/components/schemas/StatValue'
    FlatNeuralStats:
      type: object
      properties:
        _nodes:
          \$ref: '#/components/schemas/NodesInfo'
        cluster_name:
          type: string
        info:
          type: object
          properties:
            cluster_version:
              \$ref: '#/components/schemas/StatValue'
            processors.ingest.text_embedding_processors_in_pipelines:
              \$ref: '#/components/schemas/StatValue'
        all_nodes:
          type: object
          properties:
            processors.ingest.text_embedding_executions:
              \$ref: '#/components/schemas/StatValue'
        nodes:
          type: object
          additionalProperties:
            type: object
            properties:
              processors.ingest.text_embedding_executions:
                \$ref: '#/components/schemas/StatValue'
    # Stat Value
    StatValue:
      oneOf:
        - type: integer
        - type: string
        - \$ref: '#/components/schemas/StatMetadata'
      description: |
        Stat value representation that varies based on include_metadata:
        - Raw value when false
        - Metadata object when true
    StatMetadata:
      type: object
      discriminator:
        propertyName: stat_type
      required:
        - value
        - stat_type
      properties:
        value:
          oneOf:
            - type: integer
            - type: string
        stat_type:
          type: string
          enum: &stat_types
            - info_string
            - info_counter
            - timestamped_event_counter

    # Stat Types
    InfoStringStat:
      allOf:
        - \$ref: '#/components/schemas/StatMetadata'
        - type: object
          properties:
            stat_type:
              const: info_string
    InfoCounterStat:
      allOf:
        - \$ref: '#/components/schemas/StatMetadata'
        - type: object
          properties:
            stat_type:
              const: info_counter
    TimestampedEventCounterStat:
      allOf:
        - \$ref: '#/components/schemas/StatMetadata'
        - type: object
          properties:
            stat_type:
              const: timestamped_event_counter
            trailing_interval_value:
              type: integer
            minutes_since_last_event:
              type: integer