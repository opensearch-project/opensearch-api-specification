openapi: 3.1.0
info:
  title: OpenSearch Flow Framework API
  description: OpenSearch Flow Framework API.
  version: 1.0.0
paths:
  /_plugins/_flow_framework/workflow:
    post:
      operationId: flow_framework.create.0
      x-operation-group: flow_framework.create
      x-version-added: '2.12'
      description: Create a workflow.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/create-workflow/
      parameters:
        - $ref: '#/components/parameters/flow_framework.create::query.provision'
        - $ref: '#/components/parameters/flow_framework.create::query.reprovision'
        - $ref: '#/components/parameters/flow_framework.create::query.update_fields'
        - $ref: '#/components/parameters/flow_framework.create::query.use_case'
        - $ref: '#/components/parameters/flow_framework.create::query.validation'
      requestBody:
        $ref: '#/components/requestBodies/flow_framework.create'
      responses:
        '201':
          $ref: '#/components/responses/flow_framework.create@201'
        '403':
          $ref: '#/components/responses/flow_framework.create@403'
        '400':
          $ref: '#/components/responses/flow_framework.create@400'
  /_plugins/_flow_framework/workflow/{workflow_id}:
    get:
      operationId: flow_framework.get.0
      x-operation-group: flow_framework.get
      x-version-added: '2.12'
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/get-workflow/
      description: Get a workflow.
      parameters:
        - $ref: '#/components/parameters/flow_framework.get::path.workflow_id'
      responses:
        '200':
          $ref: '#/components/responses/flow_framework.get@200'
        '404':
          $ref: '#/components/responses/flow_framework.get@404'
    put:
      operationId: flow_framework.update.0
      x-operation-group: flow_framework.update
      x-version-added: '2.12'
      description: Update a workflow. You can only update a complete workflow if it has not yet been provisioned.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/create-workflow/
      parameters:
        - $ref: '#/components/parameters/flow_framework.update::path.workflow_id'
        - $ref: '#/components/parameters/flow_framework.update::query.provision'
        - $ref: '#/components/parameters/flow_framework.update::query.reprovision'
        - $ref: '#/components/parameters/flow_framework.update::query.update_fields'
        - $ref: '#/components/parameters/flow_framework.update::query.use_case'
        - $ref: '#/components/parameters/flow_framework.update::query.validation'
      requestBody:
        $ref: '#/components/requestBodies/flow_framework.update'
      responses:
        '201':
          $ref: '#/components/responses/flow_framework.update@201'
          description: It returns the workflow_id
        '404':
          $ref: '#/components/responses/flow_framework.update@404'
        '400':
          $ref: '#/components/responses/flow_framework.update@400'
    delete:
      operationId: flow_framework.delete.0
      x-operation-group: flow_framework.delete
      x-version-added: '2.12'
      description: Delete a workflow.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/delete-workflow/
      parameters:
        - $ref: '#/components/parameters/flow_framework.delete::path.workflow_id'
        - $ref: '#/components/parameters/flow_framework.delete::query.clear_status'
      responses:
        '200':
          $ref: '#/components/responses/flow_framework.delete@200'
        '400':
          $ref: '#/components/responses/flow_framework.delete@400'
        '403':
          $ref: '#/components/responses/flow_framework.delete@403'
  /_plugins/_flow_framework/workflow/_steps:
    get:
      operationId: flow_framework.get_steps.0
      x-operation-group: flow_framework.get_steps
      x-version-added: '2.12'
      description: Get a list of workflow steps.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/get-workflow-steps/
      parameters:
        - $ref: '#/components/parameters/flow_framework.get_steps::query.workflow_step'
      responses:
        '200':
          $ref: '#/components/responses/flow_framework.get_steps@200'
        '403':
          $ref: '#/components/responses/flow_framework.get_steps@403'
        '400':
          $ref: '#/components/responses/flow_framework.get_steps@400'
  /_plugins/_flow_framework/workflow/{workflow_id}/_status:
    get:
      operationId: flow_framework.get_status.0
      x-operation-group: flow_framework.get_status
      x-version-added: '2.12'
      description: Get the provisioning deployment status until it is complete.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/api/get-workflow-status/
      parameters:
        - $ref: '#/components/parameters/flow_framework.get_status::path.workflow_id'
        - $ref: '#/components/parameters/flow_framework.get_status::query.all'
      responses:
        '200':
          $ref: '#/components/responses/flow_framework.get_status@200'
        '403':
          $ref: '#/components/responses/flow_framework.get_status@403'
        '404':
          $ref: '#/components/responses/flow_framework.get_status@404'
#    /_plugins/_flow_framework/workflow/_search:
#      post: { }
#      get: { }
#    /_plugins/_flow_framework/workflow/state/_search:
#      post: { }
#      get: { }
#    /_plugins/_flow_framework/workflow/{workflow_id}/_deprovision:
#      post: { }
#    /_plugins/_flow_framework/workflow/{workflow_id}/_provision:
#      post: { }

components:
  parameters:
    flow_framework.get::path.workflow_id:
      name: workflow_id
      in: path
      required: true
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowID'
    flow_framework.get_status::path.workflow_id:
      name: workflow_id
      in: path
      required: true
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowID'
    flow_framework.update::path.workflow_id:
      name: workflow_id
      in: path
      required: true
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowID'
    flow_framework.delete::path.workflow_id:
      name: workflow_id
      in: path
      required: true
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowID'
    flow_framework.create::query.provision:
      in: query
      name: provision
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Provision'
    flow_framework.update::query.provision:
      in: query
      name: provision
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Provision'
    flow_framework.create::query.reprovision:
      x-version-added: '2.17'
      in: query
      name: reprovision
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Reprovision'
    flow_framework.update::query.reprovision:
      x-version-added: '2.17'
      in: query
      name: reprovision
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Reprovision'
    flow_framework.create::query.use_case:
      description: To use a workflow template, specify it in the use_case query parameter when creating a workflow.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/workflow-templates/#supported-workflow-templates
      in: query
      name: use_case
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/UseCase'
    flow_framework.get_status::query.all:
      description: The all parameter specifies whether the response should return all fields.
      in: query
      name: all
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/All'
    flow_framework.update::query.use_case:
      description: To use a workflow template, specify it in the use_case query parameter when creating a workflow.
      externalDocs:
        url: https://opensearch.org/docs/latest/automating-configurations/workflow-templates/#supported-workflow-templates
      in: query
      name: use_case
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/UseCase'
    flow_framework.create::query.validation:
      in: query
      name: validation
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Validation'
    flow_framework.update::query.validation:
      in: query
      name: validation
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/Validation'
    flow_framework.update::query.update_fields:
      in: query
      name: update_fields
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/UpdateFields'
    flow_framework.create::query.update_fields:
      in: query
      name: update_fields
      schema:
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/UpdateFields'
    flow_framework.delete::query.clear_status:
      in: query
      name: clear_status
      schema:
        description: Delete the workflow state (without deprovisioning resources) after deleting the template. OpenSearch deletes the workflow state only if the provisioning status is not IN_PROGRESS. Default is false.
        type: boolean
        default: false
    flow_framework.get_steps::query.workflow_step:
      in: query
      name: workflow_step
      required: false
      schema:
        description: The name of the step to retrieve.
        $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowStepName'
  requestBodies:
    flow_framework.create:
      content:
        application/json:
          schema:
            $ref: '../schemas/flow_framework.common.yaml#/components/schemas/FlowFrameworkCreate'
    flow_framework.update:
      content:
        application/json:
          schema:
            $ref: '../schemas/flow_framework.common.yaml#/components/schemas/FlowFrameworkUpdate'
  responses:
    flow_framework.create@201:
      content:
        application/json:
          schema:
            type: object
            properties:
              workflow_id:
                type: string
                description: The ID of the workflow to be updated. Required for the PUT method.
            required:
              - workflow_id
    flow_framework.create@403:
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/FlowFrameworkAPIDisabledError'
    flow_framework.create@400:
      description: Bad Request - Multiple possible reasons
      content:
        application/json:
          oneOf:
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/InvalidParameterError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/ConflictError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/MissingParameterError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/ParameterConflictError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/MaxWorkflowsLimitError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/WorkflowSaveError'
    flow_framework.update@400:
      description: Bad Request - Multiple possible reasons
      content:
        application/json:
          oneOf:
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/InvalidParameterError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/ConflictError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/MissingParameterError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/ParameterConflictError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/MaxWorkflowsLimitError'
            - $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/WorkflowSaveError'
    flow_framework.update@201:
      content:
        application/json:
          schema:
            type: object
            properties:
              workflow_id:
                type: string
                description: The ID of the workflow to be updated. Required for the PUT method.
            required:
              - workflow_id
    flow_framework.delete@200:
      content:
        application/json:
          $ref: '../schemas/flow_framework.common.yaml#/components/schemas/FlowFrameworkDeleteResponse'
    flow_framework.get@200:
      content:
        application/json:
          $ref: '../schemas/flow_framework.common.yaml#/components/schemas/FlowFrameworkGetResponse'
    flow_framework.update@404:
      description: Template Not Found Error
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/TemplateNotFoundError'
    flow_framework.delete@400:
      description: Work Flow Id Null Error
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/WorkFlowIdNullError'
    flow_framework.delete@403:
      description: Flow Framework API Disabled Error
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/FlowFrameworkAPIDisabledError'
    flow_framework.get@404:
      description: Template Not Found Error
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/TemplateNotFoundError'
    flow_framework.get_steps@200:
      content:
        application/json:
          $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkflowStep'
    flow_framework.get_steps@403:
      description: Flow Framework API Disabled Error
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/FlowFrameworkAPIDisabledError'
    flow_framework.get_steps@400:
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/WorkflowStepsRetrieveError'
    flow_framework.get_status@403:
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/FlowFrameworkAPIDisabledError'
    flow_framework.get_status@404:
      content:
        application/json:
          $ref: '../schemas/flow_framework.errors.yaml#/components/schemas/TemplateNotFoundError'
    flow_framework.get_status@200:
      content:
        application/json:
          oneOf:
            - $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkFlowStatusFullResponse'
            - $ref: '../schemas/flow_framework.common.yaml#/components/schemas/WorkFlowStatusDefaultResponse'

