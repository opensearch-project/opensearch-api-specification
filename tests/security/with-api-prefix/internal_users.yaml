$schema: ../../../json_schemas/test_story.schema.yaml

description: Test internal users endpoints.

chapters:
  - synopsis: Get internal users bulk.
    path: /_plugins/_security/api/internalusers
    method: GET
    response:
      status: 200
  - synopsis: Patch internal users bulk.
    path: /_plugins/_security/api/internalusers
    method: PATCH
    request_body:
      payload: 
        - op: add
          path: /test
          value: 
            backend_roles: [admin]
    response:
      status: 200
  - synopsis: Create internal user.
    path: /_plugins/_security/api/internalusers/{username}
    method: PUT
    parameters:
      username: test
    request_body:
      payload:
        password: myWeakPassword123!
        opendistro_security_roles: []
        backend_roles: []
        attributes: {}
    response:
      status: 200
  - synopsis: Get internal user.
    path: /_plugins/_security/api/internalusers/{username}
    method: GET
    parameters:
      username: test
    response:
      status: 200
  - synopsis: Patch internal user.
    path: /_plugins/_security/api/internalusers/{username}
    method: PATCH
    parameters:
      username: test
    request_body:
      payload:
        op: replace
        path: /opendistro_security_roles
        value: [ship_manager]
    response:
      status: 200
  - synopsis: Delete internal user.
    path: /_plugins/_security/api/internalusers/{username}
    method: DELETE
    parameters:
      username: test
    response:
      status: 200
