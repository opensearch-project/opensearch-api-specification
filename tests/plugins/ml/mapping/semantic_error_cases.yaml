$schema: ../../../../json_schemas/test_story.schema.yaml

description: Test semantic field type error cases and validation.
version: '>= 3.1'

prologues: []

epilogues:
  - path: /semantic_error_test
    method: DELETE
    status: [200, 404]

chapters:
  # Test 1: Create semantic field without required model_id
  - synopsis: Attempt to create semantic field without model_id (should fail).
    path: /{index}
    method: PUT
    parameters:
      index: semantic_error_test
    request:
      payload:
        mappings:
          properties:
            invalid_semantic:
              type: semantic
    response:
      status: 400

  # Test 2: Create semantic field with non-existent model_id
  - synopsis: Attempt to create semantic field with non-existent model.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_error_test
    request:
      payload:
        mappings:
          properties:
            invalid_semantic:
              type: semantic
              model_id: non_existent_model_12345
    response:
      status: [400, 404]

  # Test 3: Create semantic field with invalid chunking configuration
  - synopsis: Attempt to create semantic field with invalid chunking array.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_error_test
    request:
      payload:
        mappings:
          properties:
            invalid_chunking:
              type: semantic
              model_id: test_model
              chunking:
                - algorithm: invalid_algorithm
    response:
      status: [400]

  # Test 4: Create semantic field with invalid dense embedding config
  - synopsis: Attempt to create semantic field with invalid dense config.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_error_test
    request:
      payload:
        mappings:
          properties:
            invalid_dense:
              type: semantic
              model_id: test_model
              dense_embedding_config:
                data_type: invalid_type
    response:
      status: [400]

  # Test 5: Test get mapping on non-existent index
  - synopsis: Get mapping for non-existent index.
    path: /{index}/_mapping
    method: GET
    parameters:
      index: non_existent_index_semantic
    response:
      status: 404

  # Test 6: Test get field mapping for non-existent field
  - synopsis: Get field mapping for non-existent field.
    warnings:
      multiple-paths-detected: false
    path: /{index}/_mapping/field/{fields}
    method: GET
    parameters:
      index: semantic_error_test
      fields: non_existent_field
    response:
      status: 404

