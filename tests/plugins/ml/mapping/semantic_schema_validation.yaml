$schema: ../../../../json_schemas/test_story.schema.yaml

description: Test semantic field type schema validation without requiring ML models.
version: '>= 3.1'

prologues: []

epilogues:
  - path: /semantic_schema_test
    method: DELETE
    status: [200, 404]

chapters:
  # Test 1: Verify semantic field type is recognized by OpenSearch
  # Success criteria: NOT "unknown field type" error
  # Expected: Model not found error proves semantic type is recognized
  - synopsis: Create semantic field with minimal required properties.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_schema_test
    request:
      payload:
        mappings:
          properties:
            content:
              type: semantic
              model_id: test_model_placeholder
    response:
      # 200 = success (unlikely without model)
      # 400/500 = model not found error (proves semantic type is recognized!)
      # Note: If semantic type was invalid, we'd get "unknown field type" error
      status: [200, 400, 500]

  # Test 2: Verify all semantic field properties are accepted
  - synopsis: Create semantic field with all optional properties.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_schema_test
    request:
      payload:
        mappings:
          properties:
            advanced:
              type: semantic
              model_id: test_model
              search_model_id: search_model
              raw_field_type: text
              semantic_info_field_name: _meta
              semantic_field_search_analyzer: standard
              skip_existing_embedding: true
              chunking: true
              dense_embedding_config:
                data_type: float
                mode: on_disk
              sparse_encoding_config:
                prune_type: top_k
                prune_ratio: 0.5
    response:
      # Accept any of these - we're testing schema acceptance, not functionality
      status: [200, 400, 500]

  # Test 3: Verify chunking array syntax is accepted
  - synopsis: Create semantic field with array chunking configuration.
    path: /{index}
    method: PUT
    parameters:
      index: semantic_schema_test
    request:
      payload:
        mappings:
          properties:
            chunked:
              type: semantic
              model_id: test_model
              chunking:
                - algorithm: fixed
                  parameters:
                    chunk_size: 256
    response:
      status: [200, 400, 500]

